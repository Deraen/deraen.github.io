<!DOCTYPE html>
<html itemscope="" itemtype="http://schema.org/BlogPosting"><head><meta charset="utf-8" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport" /><link href="/favicon.ico" rel="shortcut icon" /><link href="/atom.xml" rel="alternate" title="Atom feed" type="application/atom+xml" /><link href="/css/app.css" rel="stylesheet" type="text/css" /><link href="http://fonts.googleapis.com/css?family=Source%2BCode%2BPro%7CArvo%3A400%2C700%7CDroid%2BSerif%3A400%2C400italic%2C700" rel="stylesheet" type="text/css" /><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/languages/clojure.min.js" type="text/javascript"></script><script>hljs.initHighlightingOnLoad();</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-36245688-2', 'auto');
ga('send', 'pageview');</script><meta content="Juho Teperi (juho.teperi@iki.fi)" itemprop="author" name="author" /><meta content="boot, blog" itemprop="keywords" name="keywords" /><meta itemprop="description" name="description" /><meta content="en" itemprop="inLanguage" /><meta content="Sat Jul 04 03:00:00 EEST 2015" itemprop="dateCreated" /><meta content="Wed Jul 08 03:00:00 EEST 2015" itemprop="dateModified" /><meta content="Sat Jul 04 03:00:00 EEST 2015" itemprop="datePublished" /><title itemprop="name">Hello World – Building a blog using Boot - Deraen's blog</title><link href="http://deraen.github.io/hello-world/" rel="canonical" /></head><body><nav class="header" role="navigation"><div class="container"><a class="site" href="/">Deraen's blog</a><ul><li><a href="/tags/">tags</a></li></ul></div></nav><div class="main"><div class="container"><article><h1 itemprop="name">Hello World – Build­ing a blog us­ing Boot</h1><div class="meta">04 July 2015</div><p>I've been plan­ning on start­ing a blog for some time already. But as I love hack­ing with build tools and such I usu­ally spend some days try­ing a blog gen­er­ator be­fore de­cid­ing it's not good enough and start writ­ing a new one, without ever fin­ish­ing any­thing. Thus I was happy when I saw <a href="https://github.com/hashobject/perun">Perun</a> which does pretty much everything I want:</p>
<ul>
  <li>Modular design, easy to extend</li>
  <li>No forced metadata schema</li>
  <li><del>RSS</del> Atom feed</li>
  <li>Reads markdown</li>
  <li>Templating using Hiccup</li>
</ul>
<h2><a href="#perun" name="perun"></a>Perun</h2>
<p>While work­ing on a pro­ject I like to con­stantly see what is the res­ult of the code I'm work­ing on. On Clo­jure­Script I use <a href="https://github.com/bhauman/lein-figwheel">Figwheel</a>. Thus I wanted the same ex­per­i­ence for work­ing on blog, though this is not that use­ful when writ­ing it's use­ful while set­ting up the blog. To make this work­flow pos­sible with Perun a two changes were im­ple­men­ted:</p>
<h3><a href="#fast-rebuilds" name="fast-rebuilds"></a>Fast re­builds</h3>
<p>Pars­ing the mark­down files and their metadata into Clo­jure data takes re­l­at­ively long. If the file has not been changed that work is un­ne­ces­sary. Boot's <code>watch</code> task and file­set provide an easy way to see which files changed since the last build. Per­un's <code>markdown</code>-task which parses the files uses this to read only changed files and merge the changed metadata to ex­ist­ing metadata from pre­vi­ous builds. This provides build times of around 100ms when post con­tent has been changed.</p>
<h3><a href="#clojure-changes" name="clojure-changes"></a>Clo­jure changes</h3>
<p>Tem­plat­ing in Perun is done from Clo­jure us­ing Hic­cup. To auto­mat­ic­ally render the changes whenever the clj files change the render tasks use Boot pods to run the code in fresh en­vir­on­ment. This way the Clo­jure namespaces are re­loaded after the changes and changes are in­stantly seen. Be­cause all namespaces re­quired by the render namespaces has to be loaded when files change, it usu­ally takes around 10 seconds to build the site after clj file change.</p>
<p>Al­tern­at­ive ap­proach would be to use <a href="https://github.com/clojure/tools.namespace">tools.namespace</a> to re­load the changed namespaces. That should be quite a bit faster at the ex­pense of sim­pli­city. This ap­proach is used by <a href="https://github.com/martinklepsch/boot-garden">boot-garden</a>.</p>
<h3><a href="#extendability" name="extendability"></a>Ex­tend­ab­il­ity</h3>
<p>As men­tioned Perun should be easy to ex­tend. This is achieved by im­ple­ment­ing Perun us­ing mul­tiple Boot tasks which can be com­posed. Be­low is a ex­ample from this blo­g's <code>build.boot</code> file which shows some ex­amples of the ex­tend­ab­il­ity. The tasks can be cat­egor­ized in three types:</p>
<ol>
  <li>Tasks which <strong>read</strong> metadata from files, currently only <code>markdown</code> (1)</li>
  <li>Tasks which <strong>ma­nip­u­late</strong> the metadata (2)</li>
  <li>Tasks which <strong>render</strong> some output (3, 4)</li>
</ol>
<pre><code class="clj">(deftask split-keywords []
  (boot/with-pre-wrap fileset
    (-&gt;&gt; fileset
         (perun/get-perun-meta)
         (perun/map-vals
           (fn [{:keys [keywords] :as post}]
             (if (string? keywords)
               (assoc post :keywords (-&gt;&gt; (string/split keywords #",")
                                          (mapv string/trim)))
               post)))
         (perun/with-perun-meta fileset))))

(deftask build
  [p prod bool "Build rss, sitemap etc."]
  (comp (less :source-map true :compress prod)
        ;; 1
        (markdown)
        ;; 2
        (if prod (draft) identity)
        (slug)
        (permalink)
        (split-keywords)
        ;; 3
        (render :renderer 'blog.views.post/render)
        (collection :renderer 'blog.views.index/render :page "index.html")
        (collection :renderer 'blog.views.tags/render :page "tags/index.html")
        (collection :renderer 'blog.views.atom/render :page "atom.xml")
        ;; 4
        (if prod (sitemap :filename "sitemap.xml") identity)
        (if prod
          (rss :title "Blog"
               :description "Deraen's blog"
               :link "http://deraen.github.io")
          identity)))
</code></pre>
<p>The task <code>split-keywords</code> is a task which ma­nip­u­lates the metadata by split­ting keyword strings. Though I now see that I should in­stead just define the keywords as ar­rays in YAML metadata of the posts.</p>
<p>In this ex­ample there are five tasks which out­put files. A task which renders all the posts, two tasks which render a col­lec­tion view and tasks for RSS and sitem­ap. The second col­lec­tion task col­lects a list of all of tags (keywords) in the posts and cre­ates a tag cloud out of those, what is cool here is that to cre­ate a tag page no spe­cial task was needed as the render func­tion can it­self do the ne­ces­sary work (one <code>reduce</code>).</p>
<p>Render tasks do not need to ne­ces­sar­ily out­put HTML, they can pro­duce string in any way which is then writ­ten to the file. <code>collection</code>-task can for ex­ample pro­duce HTML us­ing Hic­cup or XML us­ing data.xml.</p>
<h2><a href="#html-and-css-livereload" name="html-and-css-livereload"></a>HTML and CSS livere­load</h2>
<p>Fig­wheel style Clo­jure­Script de­vel­op­ment is already pos­sible with <a href="http://boot-clj.com">Boot</a> us­ing <a href="https://github.com/adzerk-oss/boot-reload">boot-reload</a> but that is heav­ily built for Clo­jure­Script use cases. The cli­ent is writ­ten in Clo­jure­Script so a built step is re­quired. <del>Also boot-re­load does­n't handle HTML file re­loads which are the es­sen­tial for be­ing use­ful for static page de­vel­op­ment.</del> Boot-re­load does handle HTML re­loads.</p>
<p>Pre­vi­ously I've been us­ing <a href="http://livereload.com">LiveReload.js</a> with <a href="http://gulpjs.com/">Gulp.js</a> so I thought that should be a good fit for Boot also. Luck­ily <a href="https://github.com/bhurlow/clj-livereload">a Clojure implementation</a> of LiveRe­load already ex­is­ted. It re­quired some API changes to make it gen­er­ally us­able lib­rary. After the changes it was a breeze to cre­ate a <a href="https://github.com/Deraen/boot-livereload">boot task</a>.</p>
<h2><a href="#cool-features-and-possibilities" name="cool-features-and-possibilities"></a>Cool fea­tures and pos­sib­il­it­ies</h2>
<p>As it is easy to ma­nip­u­late the data between read­ing the files and ren­der­ing there is great op­por­tun­ity to move some fea­tures which are usu­ally im­ple­men­ted in the browser to build pro­cess. The value I see there is that RSS read­ers (A­FAIK) do not ex­ecute JS so those read­ers are left without e.g. code high­light­ing.</p>
<p>An­other pos­sib­il­ity is to hy­phen­ate the text. This is even more use­ful as the hy­phen­a­tion is re­l­at­ively ex­pens­ive op­er­a­tion so it's great if it only needs to be ex­ecuted once in­stead of each page load. For this reason I already star­ted writ­ing <a href="https://github.com/Deraen/clj-hyphenate">clj-hyphenate</a> which im­ple­ments Frank­lin M. Li­ang's hy­phen­a­tion al­gorithm in Clo­jure. The al­gorithm is the same as used by TeX, Lib­reOf­fice and Hy­phen­at­or.js. To hy­phen­ate HTML it is pos­sible to in­sert soft-hy­phens into the text which the browser only shows if the word needs to be split into mul­tiple lines.</p><aside><div class="meta"><span class="meta-label">Tags: </span><ul class="keywords"><li><a href="/tags/#boot">boot</a></li><li><a href="/tags/#blog">blog</a></li></ul></div></aside><aside class="comments"><div><div id="disqus_thread"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES * * */
     var disqus_shortname = 'deraen';
     var disqus_identifier = 'hello-world/';

     /* * * DON'T EDIT BELOW THIS LINE * * */
     (function() {
     var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
     dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></aside></article></div></div><footer class="footer"><div class="container"><ul><li><a href="/atom.xml">RSS</a></li><li><a href="https://github.com/Deraen">github.com/Deraen</a></li><li><a href="https://twitter.com/JuhoTeperi">twitter.com/JuhoTeperi</a></li><li><a href="http://metosin.fi">metosin.fi</a></li></ul></div></footer></body></html>