<!DOCTYPE html>
<html itemscope="" itemtype="http://schema.org/BlogPosting"><head><meta charset="utf-8"><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"><meta content="width=device-width, initial-scale=1.0, user-scalable=no" name="viewport"><link href="/favicon.ico" rel="shortcut icon"><link href="/atom.xml" rel="alternate" title="Atom feed" type="application/atom+xml"><link href="/css/app.css" rel="stylesheet" type="text/css"><link href="http://fonts.googleapis.com/css?family=Source%2BCode%2BPro%7CArvo%3A400%2C700%7CDroid%2BSerif%3A400%2C400italic%2C700" rel="stylesheet" type="text/css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/languages/clojure.min.js" type="text/javascript"></script><script>hljs.initHighlightingOnLoad();</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-36245688-2', 'auto');
ga('send', 'pageview');</script><meta content="Juho Teperi (juho.teperi@iki.fi)" itemprop="author" name="author"><meta content="boot, blog" itemprop="keywords" name="keywords"><meta itemprop="description" name="description"><meta content="en" itemprop="inLanguage"><meta content="Sat Jul 04 03:00:00 EEST 2015" itemprop="dateCreated"><meta content="Wed Jul 08 03:00:00 EEST 2015" itemprop="dateModified"><meta content="Sat Jul 04 03:00:00 EEST 2015" itemprop="datePublished"><title itemprop="name">Hello World – Building a blog using Boot - Deraen's blog</title><link href="http://deraen.github.io/hello-world/" rel="canonical"></head><body><nav class="header" role="navigation"><div class="container"><a class="site" href="/">Deraen's blog</a><ul><li><a href="/tags/">tags</a></li></ul></div></nav><div class="main"><div class="container"><article><h1 itemprop="name">Hello World – Building a blog using Boot</h1><div class="meta">04 July 2015</div><p>I've been planning on starting a blog for some time already. But as I love hacking with build tools and such I usually spend some days trying a blog generator before deciding it's not good enough and start writing a new one, without ever finishing anything. Thus I was happy when I saw <a href="https://github.com/hashobject/perun">Perun</a> which does pretty much everything I want:</p>
<ul>
  <li>Modular design, easy to extend</li>
  <li>No forced metadata schema</li>
  <li><del>RSS</del> Atom feed</li>
  <li>Reads markdown</li>
  <li>Templating using Hiccup</li>
</ul>
<h2><a href="#perun" name="perun"></a>Perun</h2>
<p>While working on a project I like to constantly see what is the result of the code I'm working on. On ClojureScript I use <a href="https://github.com/bhauman/lein-figwheel">Figwheel</a>. Thus I wanted the same experience for working on blog, though this is not that useful when writing it's useful while setting up the blog. To make this workflow possible with Perun a two changes were implemented:</p>
<h3><a href="#fast-rebuilds" name="fast-rebuilds"></a>Fast rebuilds</h3>
<p>Parsing the markdown files and their metadata into Clojure data takes relatively long. If the file has not been changed that work is unnecessary. Boot's <code>watch</code> task and fileset provide an easy way to see which files changed since the last build. Perun's <code>markdown</code>-task which parses the files uses this to read only changed files and merge the changed metadata to existing metadata from previous builds. This provides build times of around 100ms when post content has been changed.</p>
<h3><a href="#clojure-changes" name="clojure-changes"></a>Clojure changes</h3>
<p>Templating in Perun is done from Clojure using Hiccup. To automatically render the changes whenever the clj files change the render tasks use Boot pods to run the code in fresh environment. This way the Clojure namespaces are reloaded after the changes and changes are instantly seen. Because all namespaces required by the render namespaces has to be loaded when files change, it usually takes around 10 seconds to build the site after clj file change.</p>
<p>Alternative approach would be to use <a href="https://github.com/clojure/tools.namespace">tools.namespace</a> to reload the changed namespaces. That should be quite a bit faster at the expense of simplicity. This approach is used by <a href="https://github.com/martinklepsch/boot-garden">boot-garden</a>.</p>
<h3><a href="#extendability" name="extendability"></a>Extendability</h3>
<p>As mentioned Perun should be easy to extend. This is achieved by implementing Perun using multiple Boot tasks which can be composed. Below is a example from this blog's <code>build.boot</code> file which shows some examples of the extendability. The tasks can be categorized in three types:</p>
<ol>
  <li>Tasks which <strong>read</strong> metadata from files, currently only <code>markdown</code> (1)</li>
  <li>Tasks which <strong>manipulate</strong> the metadata (2)</li>
  <li>Tasks which <strong>render</strong> some output (3, 4)</li>
</ol>
<pre><code class="clj">(deftask split-keywords []
  (boot/with-pre-wrap fileset
    (-&gt;&gt; fileset
         (perun/get-perun-meta)
         (perun/map-vals
           (fn [{:keys [keywords] :as post}]
             (if (string? keywords)
               (assoc post :keywords (-&gt;&gt; (string/split keywords #&quot;,&quot;)
                                          (mapv string/trim)))
               post)))
         (perun/with-perun-meta fileset))))

(deftask build
  [p prod bool &quot;Build rss, sitemap etc.&quot;]
  (comp (less :source-map true :compress prod)
        ;; 1
        (markdown)
        ;; 2
        (if prod (draft) identity)
        (slug)
        (permalink)
        (split-keywords)
        ;; 3
        (render :renderer &#39;blog.views.post/render)
        (collection :renderer &#39;blog.views.index/render :page &quot;index.html&quot;)
        (collection :renderer &#39;blog.views.tags/render :page &quot;tags/index.html&quot;)
        (collection :renderer &#39;blog.views.atom/render :page &quot;atom.xml&quot;)
        ;; 4
        (if prod (sitemap :filename &quot;sitemap.xml&quot;) identity)
        (if prod
          (rss :title &quot;Blog&quot;
               :description &quot;Deraen&#39;s blog&quot;
               :link &quot;http://deraen.github.io&quot;)
          identity)))
</code></pre>
<p>The task <code>split-keywords</code> is a task which manipulates the metadata by splitting keyword strings. Though I now see that I should instead just define the keywords as arrays in YAML metadata of the posts.</p>
<p>In this example there are five tasks which output files. A task which renders all the posts, two tasks which render a collection view and tasks for RSS and sitemap. The second collection task collects a list of all of tags (keywords) in the posts and creates a tag cloud out of those, what is cool here is that to create a tag page no special task was needed as the render function can itself do the necessary work (one <code>reduce</code>).</p>
<p>Render tasks do not need to necessarily output HTML, they can produce string in any way which is then written to the file. <code>collection</code>-task can for example produce HTML using Hiccup or XML using data.xml.</p>
<h2><a href="#html-and-css-livereload" name="html-and-css-livereload"></a>HTML and CSS livereload</h2>
<p>Figwheel style ClojureScript development is already possible with <a href="http://boot-clj.com">Boot</a> using <a href="https://github.com/adzerk-oss/boot-reload">boot-reload</a> but that is heavily built for ClojureScript use cases. The client is written in ClojureScript so a built step is required. <del>Also boot-reload doesn't handle HTML file reloads which are the essential for being useful for static page development.</del> Boot-reload does handle HTML reloads.</p>
<p>Previously I've been using <a href="http://livereload.com">LiveReload.js</a> with <a href="http://gulpjs.com/">Gulp.js</a> so I thought that should be a good fit for Boot also. Luckily <a href="https://github.com/bhurlow/clj-livereload">a Clojure implementation</a> of LiveReload already existed. It required some API changes to make it generally usable library. After the changes it was a breeze to create a <a href="https://github.com/Deraen/boot-livereload">boot task</a>.</p>
<h2><a href="#cool-features-and-possibilities" name="cool-features-and-possibilities"></a>Cool features and possibilities</h2>
<p>As it is easy to manipulate the data between reading the files and rendering there is great opportunity to move some features which are usually implemented in the browser to build process. The value I see there is that RSS readers (AFAIK) do not execute JS so those readers are left without e.g. code highlighting.</p>
<p>Another possibility is to hyphenate the text. This is even more useful as the hyphenation is relatively expensive operation so it's great if it only needs to be executed once instead of each page load. For this reason I already started writing <a href="https://github.com/Deraen/clj-hyphenate">clj-hyphenate</a> which implements Franklin M. Liang's hyphenation algorithm in Clojure. The algorithm is the same as used by TeX, LibreOffice and Hyphenator.js. To hyphenate HTML it is possible to insert soft-hyphens into the text which the browser only shows if the word needs to be split into multiple lines.</p><aside><div class="meta"><span class="meta-label">Tags: </span><ul class="keywords"><li><a href="/tags/#boot">boot</a></li><li><a href="/tags/#blog">blog</a></li></ul></div></aside><aside class="comments"><div><div id="disqus_thread"></div><script type="text/javascript">/* * * CONFIGURATION VARIABLES * * */
       var disqus_shortname = 'deraen';
       var disqus_identifier = '/hello-world/';

       /* * * DON'T EDIT BELOW THIS LINE * * */
       (function() {
       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
       dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
       })();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></noscript></div></aside></article></div></div><footer class="footer"><div class="container"><ul><li><a href="/atom.xml">RSS</a></li><li><a href="https://github.com/Deraen">github.com/Deraen</a></li><li><a href="https://twitter.com/JuhoTeperi">twitter.com/JuhoTeperi</a></li><li><a href="http://metosin.fi">metosin.fi</a></li></ul></div></footer></body></html>